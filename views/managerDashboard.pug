doctype html
html(lang="en")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1.0")
    title Manager Dashboard - Karibu Groceries
    link(href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css", rel="stylesheet")
    link(href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap", rel="stylesheet")
    link(href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css", rel="stylesheet")
    script(src="https://cdn.jsdelivr.net/npm/chart.js")

    style.
      :root {
        --primary-color: #2A4D69;
        --secondary-color: #4B86B4;
        --accent-color: #63B4B8;
        --success-color: #2E8B57;
        --warning-color: #FFD700;
      }
      body {
        font-family: 'Poppins', sans-serif;
        background-color: #f8f9fa;
      }
      .dashboard-header {
        background-color: var(--primary-color);
        color: white;
        padding: 1.5rem;
        box-shadow: 0 2px 15px rgba(0,0,0,0.1);
      }
      .sidebar {
        background-color: white;
        min-height: 100vh;
        box-shadow: 3px 0 15px rgba(0,0,0,0.05);
        padding: 1.5rem;
      }
      .metric-card {
        background: white;
        border-radius: 10px;
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        transition: transform 0.3s;
      }
      .metric-card:hover {
        transform: translateY(-5px);
      }
      .chart-container {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
      }
      .data-table {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0,0,0,0.05);
      }
      .table thead th {
        background-color: var(--primary-color);
        color: white;
        border-bottom: none;
      }
      .badge-pill {
        padding: 0.5em 1em;
        border-radius: 20px;
      }

  body
    .dashboard-header
      .container
        .d-flex.justify-content-between.align-items-center
          h3.mb-0 Karibu Groceries Ltd
          .d-flex.align-items-center
            span.me-3 Welcome, #{user.name}
            a.btn.btn-light.btn-sm(href="/logout") Logout

    .container-fluid
      .row
        .col-md-3.sidebar
          .mb-4
            img(src="/logo-placeholder.png", alt="Company Logo", class="img-fluid mb-3")
            .list-group
              a.list-group-item.list-group-item-action.active(href="#") Dashboard
              a.list-group-item.list-group-item-action(href="#") Sales Reports
              a.list-group-item.list-group-item-action(href="#") Inventory
              a.list-group-item.list-group-item-action(href="#") Customers

        .col-md-9.p-4
          if lowStockItems && lowStockItems.length
            .alert.alert-warning.mb-4
              strong Warning! Low stock for the following produce:
              ul.mb-0
                each item in lowStockItems
                  li #{item.name} at #{item.branch} - Only #{item.quantity}kg left (Threshold: #{item.threshold}kg)

          .row.g-4
            .col-md-3
              .metric-card
                .d-flex.align-items-center
                  .bg-primary.text-white.rounded-circle.p-3.me-3
                    i.bi.bi-box-seam.fs-4
                  div
                    h6.text-muted.mb-1 Total Products
                    h4.mb-0= totalProducts

            .col-md-3
              .metric-card
                .d-flex.align-items-center
                  .bg-success.text-white.rounded-circle.p-3.me-3
                    i.bi.bi-credit-card.fs-4
                  div
                    h6.text-muted.mb-1 Credit Sales
                    h4.mb-0= totalCreditSales

            .col-md-3
              .metric-card
                .d-flex.align-items-center
                  .bg-warning.text-white.rounded-circle.p-3.me-3
                    i.bi.bi-cash-coin.fs-4
                  div
                    h6.text-muted.mb-1 Amount Owed
                    h4.mb-0 UGX #{totalAmountOwedFormatted}

            .col-md-3
              .metric-card
                .d-flex.align-items-center
                  .bg-info.text-white.rounded-circle.p-3.me-3
                    i.bi.bi-check-circle.fs-4
                  div
                    h6.text-muted.mb-1 Amount Paid
                    h4.mb-0 UGX #{totalAmountPaidFormatted}

          .chart-container
            h5.mb-4 Sales Performance by Branch
            canvas#salesChart

          .data-table.mt-4
            table.table.table-hover.mb-0
              thead
                tr
                  th Branch
                  th Total Sales
                  th Progress
                  th Status
              tbody
                each branch in salesByBranch
                  tr
                    td= branch._id
                    td UGX #{branch.formattedTotal}
                    td
                      .progress(style="height: 8px;")
                        .progress-bar.bg-primary(
                          role="progressbar",
                          style=`width: ${branch.progress}%`,
                          aria-valuenow=branch.totalSales,
                          aria-valuemin="0",
                          aria-valuemax="50000000"
                        )
                    td
                      span.badge.bg-success Active

    script.
      const ctx = document.getElementById('salesChart').getContext('2d');
      new Chart(ctx, {
        type: 'bar',
        data: {
          labels: !{JSON.stringify(salesByBranch.map(branch => branch._id))},
          datasets: [{
            label: 'Total Sales (UGX)',
            data: !{JSON.stringify(salesByBranch.map(branch => branch.totalSales))},
            backgroundColor: [
              'rgba(42, 77, 105, 0.8)',
              'rgba(75, 134, 180, 0.8)',
              'rgba(99, 180, 184, 0.8)'
            ],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: { display: false },
            title: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              ticks: {
                callback: function(value) {
                  return 'UGX ' + (value / 1000000).toFixed(1) + 'M';
                }
              }
            }
          }
        }
      });